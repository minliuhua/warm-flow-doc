# 术语规则

| 序  号 | 术语   | 术语解释                                      |
|------|------|-------------------------------------------|
| 1    | 审批   | 当前节点处理人，对当前流程节点进行审核操作，完成后进入下一节点           |
| 2    | 回退   | 当前节点处理人，将流程驳回至之前已经处理过的任务节点，要求重新处理         |
| 2    | 任意跳转 | 任意跳转(通过或者退回)指定节点                          |
| 3    | 委派   | 求助其他人审批，然后参照他的意见决定是否审批通过                  |
| 4    | 转办   | 任务转给其他人办理                                 |
| 5    | 催办   | 对于时效要求高的流程，发起人可催办提醒当前节点处理人，一般以消息通知方式提醒处理人 |
| 7    | 取回   | 将工作流中的某个任务退回给之前的发起人，以便进行修改或重新处理           |
| 7    | 撤销   | 将工作流中的某个任务退回给之前的执行者，以便进行修改或重新处理           |
| 8    | 终止   | 当前节点处理人，终止当前流程                            |
| 9    | 抄送   | 当前节点处理人，处理完成之后将处理结果抄送给其他人                 |
| 10   | 加签   | 办理中途，希望其他人一起参与办理                          |
| 11   | 减签   | 办理中途，希望某些人不参与办理                           |
| 12   | 会签   | 所有审批人审批通过，审批节点才会通过                        |
| 13   | 票签   | 满足设定的通过率，部分审批人审批通过，审批节点才会通过               |
| 13   | 或签   | 一名办理人审批通过，审批节点才会通过                        |
| 14   | 暂存   | 复杂表单，一次性填写不完，需要保存草稿功能，开始节点的暂存             |

# 流程规则

## 1、术语
1. 跳转类型：PASS-审批通过，REJECT-驳回。
1. 跳转条件：根据跳转条件，判断要执行哪个分支，比如“请假天数小于4”。
1. 节点类型：0-开始节点，1-中间节点，2-结束节点。
1. 权限标识：权限类型:权限标识，可以多个，如“role:3” ， “1,role:3,role:1”或者“1,role:3,dept:1”。
1. 所属并行网关节点编码：离上次最近的并行网关节点编码，可传递，遇新网关重置。
1. 协作类型：

```
APPROVAL-无：无其他协作方式
TRANSFER-转办：任务转给其他人办理
DEPUTE-委派：求助其他人审批，然后参照他的意见决定是否审批通过
COUNTERSIGN-会签：和其他人一起审批通过，才算通过
VOTE-票签：和部分人一起审批，达到一定通过率，才算通过
ADD_SIGNATURE-加签：办理中途，希望其他人一起参与办理
REDUCTION_SIGNATURE-减签：办理中途，希望某些人不参与办理

```



## 2、通用规则
1. 开始节点和结束节点必须有。
1. 开始节点必须有且只有一个跳转条件（跳转节点），中间和网关节点必须有跳转条件，结束节点不需要。
1. 网关节点可不需要跳转类型，互斥网关按照跳转条件流转。
1. 开启流程是传入租户id，就可以后续就可以根据租户id过来任务。
1. 角色权限控制，非必填，流程定义时通过逗号隔开多个权限，流转是传入“1,role:3” ， “1,role:3,role:1”或者“1,role:3,dept:1”，进行控制。
1. 当流程有多个结束节点，有一个完成，流程实例就算完成
1. 网关节点不可直连。
1. 一票否决（谨慎使用），如果驳回，驳回指向节点后还存在其他正在执行的待办任务，转历史任务，状态都为失效,重走流程。
1. 中间节点不可通过或者驳回到多个中间节点，必须先流转到网关节点
1. 流程变量是全局都能获取，任务变量就当前任务触发的监听器时可以获取。

## 3、流程状态
1. 待提交：开启流程后的状态
1. 审批中：提交审批后的状态
1. 驳回：就是点击驳回后的状态
1. 失效：是针对并行流程，流程完成后，还存在待办任务，把它转历史记录，历史记录状态无效
1. 审批通过：是任务完成后，待办任务转为历史记录，历史记录状态为审批通过
1. 已完成：流程结束的状态

## 4、串行网关规则
1. 以串行网关开头，只会执行后面的一条任务路线，以串行网关结尾，只需前面的一条路线完成即可往下执行（最主要限制）。
1. 串行网关需要根据传入跳转条件去判断执行哪个任务路线。


## 5、并行网关规则
1. 以并行网关开头，只会必须执行后面的所有任务路线，以并行网关结尾，前面的任务路线必须都完成即可往下执行（最主要限制）。
1. 当流程完成，并行网关范围内还存在待办任务未完成，转历史任务，状态完成。

## 6、流程图元数据流程状态规则：
- 目标节点，待办
- 开启流程:
  - 初始化流程定义json
  - 其他的：未办
- 通过:
  - 途径节点和跳转线：已办，
- 退回:
  - 途径节点和跳转线：未办，
  - 目标节点之后的所有结点和跳转线：未办
- 目标节点是结束节点:
  - 目标节点和起始节点：已办
  - 所有待办：未办
- 如果办理过程中存在并行网关，则需要判断是否需要生成新任务
  - 获取目标节点最近的并行网关集合
  - 根据目标节点递归往上找最近的并行网关，或者直到不是网关为止
  - 查询每个并行网关的所有的前置路线，记录总数量和已办理数量，如果已办数量=总数量-1，说明可以生成新任务
  - 如果前置节点是非并行网关，总数量+1，已办数量按实际情况记录
  - 如果前置节点是并行网关，递归往上找，直至找到非并行网关，记录总数量和已办数量。

